(()=>{"use strict";var __webpack_modules__={744:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),app_service_1=__webpack_require__(134);let AppController=class AppController{constructor(appService){this.appService=appService}getData(){return this.appService.getData()}};tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],AppController.prototype,"getData",null),AppController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==app_service_1.AppService&&app_service_1.AppService)?_a:Object])],AppController),exports.AppController=AppController},3713:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppModule=void 0;const tslib_1=__webpack_require__(752),mailer_1=__webpack_require__(2138),common_1=__webpack_require__(6481),core_1=__webpack_require__(143),mongoose_1=__webpack_require__(1794),environment_1=__webpack_require__(7483),app_controller_1=__webpack_require__(744),app_service_1=__webpack_require__(134),auth_module_1=__webpack_require__(4188),jwt_auth_guard_1=__webpack_require__(5059),event_module_1=__webpack_require__(3043),organization_module_1=__webpack_require__(2730),tag_module_1=__webpack_require__(1055),user_module_1=__webpack_require__(8388);let AppModule=class AppModule{};AppModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forRoot(environment_1.environment.API_URL),user_module_1.UserModule,organization_module_1.OrganizationModule,event_module_1.EventModule,auth_module_1.AuthModule,tag_module_1.TagModule,mailer_1.MailerModule.forRoot({transport:{host:"smtp.sendgrid.net",auth:{user:"apikey",pass:"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"},tls:{rejectUnauthorized:!1}}})],controllers:[app_controller_1.AppController],providers:[{provide:core_1.APP_GUARD,useClass:jwt_auth_guard_1.JwtAuthGuard},app_service_1.AppService]})],AppModule),exports.AppModule=AppModule},134:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481);let AppService=class AppService{getData(){return{message:"Welkom bij de API van Roots!"}}};AppService=tslib_1.__decorate([(0,common_1.Injectable)()],AppService),exports.AppService=AppService},5911:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuthController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),passport_1=__webpack_require__(4340),user_dto_1=__webpack_require__(565),auth_module_1=__webpack_require__(4188),auth_service_1=__webpack_require__(3207);let AuthController=class AuthController{constructor(authService){this.authService=authService}login(req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.authService.login(req.body)}))}register(UserDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.authService.register(UserDto)}))}verify(body){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.authService.verify(body)}))}resend(body){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.authService.resendVerificationMail(body.emailAddress)}))}forgotPassword(body){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.authService.forgotPasswordMail(body.emailAddress)}))}resetPassword(body){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.authService.resetPassword(body.tokenId,body.password)}))}};tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.UseGuards)((0,passport_1.AuthGuard)("local")),(0,common_1.Post)("auth/login"),tslib_1.__param(0,(0,common_1.Request)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object]),tslib_1.__metadata("design:returntype",Promise)],AuthController.prototype,"login",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Post)("auth/register"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_b=void 0!==user_dto_1.UserDto&&user_dto_1.UserDto)?_b:Object]),tslib_1.__metadata("design:returntype",Promise)],AuthController.prototype,"register",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Post)("auth/verify"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object]),tslib_1.__metadata("design:returntype",Promise)],AuthController.prototype,"verify",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Post)("auth/resend"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object]),tslib_1.__metadata("design:returntype",Promise)],AuthController.prototype,"resend",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Post)("auth/forgot_password"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object]),tslib_1.__metadata("design:returntype",Promise)],AuthController.prototype,"forgotPassword",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Post)("auth/reset_password"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object]),tslib_1.__metadata("design:returntype",Promise)],AuthController.prototype,"resetPassword",null),AuthController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==auth_service_1.AuthService&&auth_service_1.AuthService)?_a:Object])],AuthController),exports.AuthController=AuthController},4188:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuthModule=exports.Public=exports.IS_PUBLIC_KEY=void 0;const tslib_1=__webpack_require__(752);exports.IS_PUBLIC_KEY="isPublic";exports.Public=()=>(0,common_1.SetMetadata)(exports.IS_PUBLIC_KEY,!0);const common_1=__webpack_require__(6481),jwt_1=__webpack_require__(2064),passport_1=__webpack_require__(4340),email_module_1=__webpack_require__(3058),token_module_1=__webpack_require__(4247),user_module_1=__webpack_require__(8388),auth_controller_1=__webpack_require__(5911),auth_service_1=__webpack_require__(3207),constants_1=__webpack_require__(7703),jwt_strategy_1=__webpack_require__(1424),local_strategy_1=__webpack_require__(472);let AuthModule=class AuthModule{};AuthModule=tslib_1.__decorate([(0,common_1.Module)({imports:[user_module_1.UserModule,passport_1.PassportModule,jwt_1.JwtModule.register({secret:constants_1.jwtConstants.secret,signOptions:{expiresIn:"2d"}}),email_module_1.MailModule,token_module_1.TokenModule],providers:[auth_service_1.AuthService,local_strategy_1.LocalStrategy,jwt_strategy_1.JwtStrategy],exports:[auth_service_1.AuthService],controllers:[auth_controller_1.AuthController]})],AuthModule),exports.AuthModule=AuthModule},3207:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AuthService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),jwt_1=__webpack_require__(2064),bcrypt=__webpack_require__(8432),email_service_1=__webpack_require__(9032),ParseObjectIdPipe_1=__webpack_require__(8725),token_service_1=__webpack_require__(2469),user_service_1=__webpack_require__(6389),constants_1=__webpack_require__(7703);let AuthService=class AuthService{constructor(userService,jwtService,mailService,tokenService){this.userService=userService,this.jwtService=jwtService,this.mailService=mailService,this.tokenService=tokenService}login(user){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const payload={username:user.username||user.emailAddress},loggedInUser=yield this.userService.findByEmailAddress(payload.username);return{_id:loggedInUser._id,firstname:loggedInUser.firstname,lastname:loggedInUser.lastname,emailAddress:loggedInUser.emailAddress,isVerified:loggedInUser.isVerified,organization:loggedInUser.organization,access_token:this.jwtService.sign(payload,constants_1.jwtConstants)}}))}register(UserDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userService.create(UserDto),token=yield this.tokenService.create("verification",user._id.toString());return yield this.mailService.SendVerificationMail(user.emailAddress,user.firstname,token.verificationCode),user}))}validateUser(username,pass){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userService.findByEmailAddress(username);if(user&&(yield bcrypt.compareSync(pass,user.password))){if(!1===user.isActive)throw new common_1.HttpException("Jouw account is gedeactiveerd!",common_1.HttpStatus.BAD_REQUEST);return user.isVerified&&(yield this.userService.setLastLoginTimeStamp(user._id.toString())),user}throw new common_1.HttpException("Incorrecte inloggegevens!",common_1.HttpStatus.BAD_REQUEST)}))}verify(req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(!ParseObjectIdPipe_1.ParseObjectIdPipe.isValidObjectId(req.userId))throw new common_1.HttpException("Id is niet geldig!",common_1.HttpStatus.BAD_REQUEST);const user=yield this.userService.getById(req.userId),token=yield this.tokenService.getByUserId(req.userId,"verification");if(token.verificationCode===req.verificationCode&&token.expirationDate>new Date)return yield this.tokenService.delete(req.userId,"verification"),yield this.userService.verifyAccount(req.userId),yield this.userService.setLastLoginTimeStamp(req.userId),yield this.login({username:user.emailAddress,password:user.password});throw new common_1.HttpException("De verificatiecode is ongeldig!",common_1.HttpStatus.BAD_REQUEST)}))}resendVerificationMail(emailAddress){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userService.findByEmailAddress(emailAddress);yield this.tokenService.delete(user._id.toString(),"verification");const token=yield this.tokenService.create("verification",user._id.toString());return yield this.mailService.SendVerificationMail(user.emailAddress,user.firstname,token.verificationCode),{status:200,message:"Verification Email has been sent!"}}))}forgotPasswordMail(emailAddress){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userService.findByEmailAddress(emailAddress);yield this.tokenService.delete(user._id.toString(),"password_reset");const token=yield this.tokenService.create("password_reset",user._id.toString());return yield this.mailService.SendPasswordResetMail(user.emailAddress,user.firstname,token._id.toString()),{status:200,message:"Reset Password Email has been sent!"}}))}resetPassword(tokenId,password){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const token=yield this.tokenService.getById(tokenId);if(yield this.tokenService.delete(token.userId.toString(),"password_reset"),token.expirationDate>new Date)return yield this.userService.setPassword(token.userId.toString(),password),{status:200,message:"Password has been reset!"};throw new common_1.HttpException("Token is ongeldig!",common_1.HttpStatus.BAD_REQUEST)}))}};AuthService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==user_service_1.UserService&&user_service_1.UserService)?_a:Object,"function"==typeof(_b=void 0!==jwt_1.JwtService&&jwt_1.JwtService)?_b:Object,"function"==typeof(_c=void 0!==email_service_1.MailService&&email_service_1.MailService)?_c:Object,"function"==typeof(_d=void 0!==token_service_1.TokenService&&token_service_1.TokenService)?_d:Object])],AuthService),exports.AuthService=AuthService},7703:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.jwtConstants=void 0,exports.jwtConstants={secret:"secretKey"}},5059:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.JwtAuthGuard=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),core_1=__webpack_require__(143),passport_1=__webpack_require__(4340),auth_module_1=__webpack_require__(4188);let JwtAuthGuard=class JwtAuthGuard extends((0,passport_1.AuthGuard)("jwt")){constructor(reflector){super(),this.reflector=reflector}canActivate(context){return!!this.reflector.getAllAndOverride(auth_module_1.IS_PUBLIC_KEY,[context.getHandler(),context.getClass()])||super.canActivate(context)}};JwtAuthGuard=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==core_1.Reflector&&core_1.Reflector)?_a:Object])],JwtAuthGuard),exports.JwtAuthGuard=JwtAuthGuard},1424:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.JwtStrategy=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),passport_1=__webpack_require__(4340),passport_jwt_1=__webpack_require__(136),user_service_1=__webpack_require__(6389),constants_1=__webpack_require__(7703);let JwtStrategy=class JwtStrategy extends((0,passport_1.PassportStrategy)(passport_jwt_1.Strategy)){constructor(userService){super({jwtFromRequest:passport_jwt_1.ExtractJwt.fromAuthHeaderAsBearerToken(),ignoreExpiration:!1,secretOrKey:constants_1.jwtConstants.secret}),this.userService=userService}validate(payload){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userService.findByEmailAddress(payload.username);if(user)return user;throw new common_1.HttpException("Login is verlopen!",common_1.HttpStatus.UNAUTHORIZED)}))}};JwtStrategy=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==user_service_1.UserService&&user_service_1.UserService)?_a:Object])],JwtStrategy),exports.JwtStrategy=JwtStrategy},472:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.LocalStrategy=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),passport_1=__webpack_require__(4340),passport_local_1=__webpack_require__(7055),auth_service_1=__webpack_require__(3207);let LocalStrategy=class LocalStrategy extends((0,passport_1.PassportStrategy)(passport_local_1.Strategy)){constructor(authService){super(),this.authService=authService}validate(username,password){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.authService.validateUser(username,password);if(!user)throw new common_1.HttpException("Er is geen gebruiker gevonden met het opgegeven e-mailadres!",common_1.HttpStatus.NOT_FOUND);return user}))}};LocalStrategy=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==auth_service_1.AuthService&&auth_service_1.AuthService)?_a:Object])],LocalStrategy),exports.LocalStrategy=LocalStrategy},2919:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_module_1=__webpack_require__(4188),event_dto_1=__webpack_require__(1702),event_service_1=__webpack_require__(7528);let EventController=class EventController{constructor(eventService){this.eventService=eventService}getAllEvents(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Retrieving all events (READ)"),yield this.eventService.getAll()}))}getEventsPerPage(organizationId,query){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Retrieving events with filter (READ)"),yield this.eventService.getPerPage(query,organizationId)}))}getEventById(eventId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){try{return common_1.Logger.log(`Retrieve event with id: ${eventId} (READ)`),yield this.eventService.getById(eventId)}catch(error){throw new common_1.HttpException(error.message,common_1.HttpStatus.NOT_FOUND)}}))}createEvent(companyId,eventDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){try{common_1.Logger.log("Create event (POST)");yield this.eventService.create(companyId,eventDto);return{status:201,message:"De gebeurtenis is succesvol aangemaakt!"}}catch(error){throw new common_1.HttpException(error.message,common_1.HttpStatus.NOT_FOUND)}}))}updateEvent(companyId,eventId,eventDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){try{common_1.Logger.log(`Update event ${eventId} from company ${companyId} (PUT)`);yield this.eventService.update(eventId,eventDto);return{status:200,message:"De gebeurtenis is succesvol aangepast!"}}catch(error){throw new common_1.HttpException(error.message,common_1.HttpStatus.NOT_MODIFIED)}}))}archiveEvent(companyId,eventId,isActive){return tslib_1.__awaiter(this,void 0,void 0,(function*(){try{return common_1.Logger.log(isActive?"Archiveren":`Dearchiveren event  from ${eventId} from company ${companyId}`),yield this.eventService.archive(eventId,isActive)}catch(error){throw new common_1.HttpException(error.message,common_1.HttpStatus.NOT_MODIFIED)}}))}};tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype","function"==typeof(_b="undefined"!=typeof Promise&&Promise)?_b:Object)],EventController.prototype,"getAllEvents",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)(":id/filter"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__param(1,(0,common_1.Query)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,Object]),tslib_1.__metadata("design:returntype","function"==typeof(_c="undefined"!=typeof Promise&&Promise)?_c:Object)],EventController.prototype,"getEventsPerPage",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)(":id"),tslib_1.__param(0,(0,common_1.Param)("id")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_d="undefined"!=typeof Promise&&Promise)?_d:Object)],EventController.prototype,"getEventById",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Post)("new/:companyId"),tslib_1.__param(0,(0,common_1.Param)("companyId")),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_e=void 0!==event_dto_1.EventDto&&event_dto_1.EventDto)?_e:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_f="undefined"!=typeof Promise&&Promise)?_f:Object)],EventController.prototype,"createEvent",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Put)(":companyId/:eventId/edit"),tslib_1.__param(0,(0,common_1.Param)("companyId")),tslib_1.__param(1,(0,common_1.Param)("eventId")),tslib_1.__param(2,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,"function"==typeof(_g=void 0!==event_dto_1.EventDto&&event_dto_1.EventDto)?_g:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_h="undefined"!=typeof Promise&&Promise)?_h:Object)],EventController.prototype,"updateEvent",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Put)(":companyId/:eventId/archive"),tslib_1.__param(0,(0,common_1.Param)("companyId")),tslib_1.__param(1,(0,common_1.Param)("eventId")),tslib_1.__param(2,(0,common_1.Query)("isActive")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,Boolean]),tslib_1.__metadata("design:returntype","function"==typeof(_j="undefined"!=typeof Promise&&Promise)?_j:Object)],EventController.prototype,"archiveEvent",null),EventController=tslib_1.__decorate([(0,common_1.Controller)("events"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==event_service_1.EventService&&event_service_1.EventService)?_a:Object])],EventController),exports.EventController=EventController},1702:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(5849);class EventDto{}tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Titel moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Titel is verplicht!"}),(0,class_validator_1.MaxLength)(75,{message:"Titel mag maximaal 75 karakters bevatten!"}),tslib_1.__metadata("design:type",String)],EventDto.prototype,"title",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Beschrijving moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Beschrijving is verplicht!"}),(0,class_validator_1.MaxLength)(150,{message:"Beschrijving mag maximaal 150 karakters bevatten!"}),tslib_1.__metadata("design:type",String)],EventDto.prototype,"description",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Inhoud moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Inhoud is verplicht!"}),tslib_1.__metadata("design:type",String)],EventDto.prototype,"content",void 0),tslib_1.__decorate([(0,class_validator_1.IsDefined)({message:"Gebeurtenisdatum is verplicht!"}),tslib_1.__metadata("design:type","function"==typeof(_a="undefined"!=typeof Date&&Date)?_a:Object)],EventDto.prototype,"eventDate",void 0),tslib_1.__decorate([(0,class_validator_1.IsBoolean)({message:"IsActive moet van het type boolean"}),tslib_1.__metadata("design:type",Boolean)],EventDto.prototype,"isActive",void 0),exports.EventDto=EventDto},3043:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),organization_schema_1=__webpack_require__(8553),event_controller_1=__webpack_require__(2919),event_schema_1=__webpack_require__(2480),event_service_1=__webpack_require__(7528);let EventModule=class EventModule{};EventModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forFeature([{name:Event.name,schema:event_schema_1.EventSchema},{name:organization_schema_1.Organization.name,schema:organization_schema_1.OrganizationSchema}])],providers:[event_service_1.EventService],controllers:[event_controller_1.EventController],exports:[event_service_1.EventService]})],EventModule),exports.EventModule=EventModule},2480:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventSchema=exports.Event=void 0;const tslib_1=__webpack_require__(752),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185);let Event=class Event{};tslib_1.__decorate([(0,mongoose_1.Prop)({required:[!0,"Titel is verplicht!"],maxLength:[75,"Titel mag maximaal 75 karakters bevatten!"]}),tslib_1.__metadata("design:type",String)],Event.prototype,"title",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({required:[!0,"Beschrijving is verplicht!"],maxLength:[150,"Beschrijving mag maximaal 150 karakters bevatten!"]}),tslib_1.__metadata("design:type",String)],Event.prototype,"description",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({required:[!0,"Inhoud is verplicht!"]}),tslib_1.__metadata("design:type",String)],Event.prototype,"content",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({required:[!0,"Gebeurtenisdatum is verplicht!"]}),tslib_1.__metadata("design:type","function"==typeof(_a="undefined"!=typeof Date&&Date)?_a:Object)],Event.prototype,"eventDate",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[],type:[mongoose_2.Types.ObjectId]}),tslib_1.__metadata("design:type",Array)],Event.prototype,"tags",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:!0}),tslib_1.__metadata("design:type",Boolean)],Event.prototype,"isActive",void 0),Event=tslib_1.__decorate([(0,mongoose_1.Schema)()],Event),exports.Event=Event,exports.EventSchema=mongoose_1.SchemaFactory.createForClass(Event)},7528:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185),organization_schema_1=__webpack_require__(8553),event_schema_1=__webpack_require__(2480);let EventService=class EventService{constructor(eventModel,organizationModel){this.eventModel=eventModel,this.organizationModel=organizationModel}getAll(){var _a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){const events=yield this.organizationModel.aggregate([{$unwind:{path:"$events"}},{$lookup:{from:"events",localField:"events",foreignField:"_id",as:"events"}},{$sort:{"events.eventDate":-1}},{$group:{_id:null,events:{$push:{_id:{$first:"$events._id"},title:{$first:"$events.title"},description:{$first:"$events.description"},eventDate:{$first:"$events.eventDate"},isActive:{$first:"$events.isActive"},tags:{$first:"$events.tags"}}}}},{$project:{_id:0,events:1}}]);return null===(_a=events[0])||void 0===_a?void 0:_a.events}))}getPerPage(query,organizationId){var _a,_b;return tslib_1.__awaiter(this,void 0,void 0,(function*(){const events=yield this.organizationModel.aggregate([{$match:{_id:new mongoose_2.Types.ObjectId(organizationId)}},{$unwind:{path:"$events"}},{$lookup:{from:"events",localField:"events",foreignField:"_id",as:"events"}},{$sort:{"events.eventDate":-1}},{$group:{_id:null,events:{$push:{_id:{$first:"$events._id"},title:{$first:"$events.title"},description:{$first:"$events.description"},eventDate:{$first:"$events.eventDate"},isActive:{$first:"$events.isActive"},tags:{$first:"$events.tags"}}}}},{$project:{_id:0,events:1}}]);if(query.old_records&&query.new_records&&"true"===query.show_archived_events)return null===(_a=events[0])||void 0===_a?void 0:_a.events.slice(Number(query.old_records),Number(query.new_records)+Number(query.old_records));if(query.old_records&&query.new_records&&"false"===query.show_archived_events){const activeEvents=[];return null===(_b=events[0])||void 0===_b||_b.events.forEach((event=>{event.isActive&&activeEvents.push(event)})),activeEvents.slice(Number(query.old_records),Number(query.new_records)+Number(query.old_records))}if(query.term&&"true"===query.show_archived_events){const matchingEvents=[];return events[0].events.forEach((event=>{event.title.includes(query.term)&&matchingEvents.push(event)})),matchingEvents}if(query.term&&"false"===query.show_archived_events){const matchingEvents=[];return events[0].events.forEach((event=>{event.title.includes(query.term)&&event.isActive&&matchingEvents.push(event)})),matchingEvents}}))}getById(id){var _a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){const event=yield this.organizationModel.aggregate([{$unwind:{path:"$events"}},{$lookup:{from:"events",localField:"events",foreignField:"_id",as:"events"}},{$match:{"events._id":new mongoose_2.default.Types.ObjectId(id)}},{$project:{_id:0,events:1}}]);if(0===event.length)throw new common_1.HttpException("Deze gebeurtenis bestaat niet!",common_1.HttpStatus.NOT_FOUND);return null===(_a=event[0])||void 0===_a?void 0:_a.events[0]}))}create(organizationId,eventDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const event=yield this.eventModel.create(eventDto),updatedOrganizationEvents=yield this.organizationModel.findOneAndUpdate({_id:organizationId},{$push:{events:event._id}},{new:!0,runValidators:!0});if(!updatedOrganizationEvents)throw new common_1.HttpException("Dit bedrijf bestaat niet!",common_1.HttpStatus.NOT_FOUND);return updatedOrganizationEvents}))}update(eventId,eventDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const updatedEventFromOrganization=yield this.eventModel.findOneAndUpdate({_id:eventId},{$set:{title:null==eventDto?void 0:eventDto.title,description:null==eventDto?void 0:eventDto.description,content:null==eventDto?void 0:eventDto.content,tags:null==eventDto?void 0:eventDto.tags,eventDate:null==eventDto?void 0:eventDto.eventDate}},{new:!0,runValidators:!0});if(!updatedEventFromOrganization)throw new common_1.HttpException("Deze gebeurtenis bestaat niet!",common_1.HttpStatus.NOT_FOUND);return updatedEventFromOrganization}))}archive(eventId,isActive){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(!(yield this.eventModel.findOneAndUpdate({_id:new mongoose_2.Types.ObjectId(eventId)},{$set:{isActive}},{new:!0,runValidators:!0})))throw new common_1.HttpException("Deze gebeurtenis bestaat niet!",common_1.HttpStatus.NOT_FOUND);return yield this.getById(eventId)}))}};EventService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,mongoose_1.InjectModel)(event_schema_1.Event.name)),tslib_1.__param(1,(0,mongoose_1.InjectModel)(organization_schema_1.Organization.name)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mongoose_2.Model&&mongoose_2.Model)?_a:Object,"function"==typeof(_b=void 0!==mongoose_2.Model&&mongoose_2.Model)?_b:Object])],EventService),exports.EventService=EventService},3593:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.OrganizationController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_module_1=__webpack_require__(4188),ParseObjectIdPipe_1=__webpack_require__(8725),organization_dto_1=__webpack_require__(6829),organization_service_1=__webpack_require__(7446);let OrganizationController=class OrganizationController{constructor(organizationService){this.organizationService=organizationService}getAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Retrieve organization (READ)"),yield this.organizationService.getAll()}))}getById(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Retrieve organization with id: ${id} (READ)`),yield this.organizationService.getById(id)}))}createCommunity(createOrganizationDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.organizationService.create(createOrganizationDto)}))}};tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)("organizations"),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype","function"==typeof(_b="undefined"!=typeof Promise&&Promise)?_b:Object)],OrganizationController.prototype,"getAll",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)("organizations/:id"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_c="undefined"!=typeof Promise&&Promise)?_c:Object)],OrganizationController.prototype,"getById",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Post)("organizations"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_d=void 0!==organization_dto_1.CreateOrganizationDTO&&organization_dto_1.CreateOrganizationDTO)?_d:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_e="undefined"!=typeof Promise&&Promise)?_e:Object)],OrganizationController.prototype,"createCommunity",null),OrganizationController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==organization_service_1.OrganizationService&&organization_service_1.OrganizationService)?_a:Object])],OrganizationController),exports.OrganizationController=OrganizationController},6829:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateOrganizationDTO=exports.CreateOrganizationDTO=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),class_validator_1=__webpack_require__(5849);class CreateOrganizationDTO{}tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Naam moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Naam is verplicht!"}),tslib_1.__metadata("design:type",String)],CreateOrganizationDTO.prototype,"name",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Email domein moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Email domein is verplicht!"}),tslib_1.__metadata("design:type",String)],CreateOrganizationDTO.prototype,"emailDomain",void 0),exports.CreateOrganizationDTO=CreateOrganizationDTO;class UpdateOrganizationDTO{}tslib_1.__decorate([(0,common_1.Optional)(),(0,class_validator_1.IsString)({message:"Naam moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Naam is verplicht!"}),tslib_1.__metadata("design:type",String)],UpdateOrganizationDTO.prototype,"name",void 0),tslib_1.__decorate([(0,common_1.Optional)(),(0,class_validator_1.IsString)({message:"Email domein moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Email domein is verplicht!"}),tslib_1.__metadata("design:type",String)],UpdateOrganizationDTO.prototype,"emailDomain",void 0),exports.UpdateOrganizationDTO=UpdateOrganizationDTO},2730:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.OrganizationModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),organization_controller_1=__webpack_require__(3593),organization_schema_1=__webpack_require__(8553),organization_service_1=__webpack_require__(7446);let OrganizationModule=class OrganizationModule{};OrganizationModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forFeature([{name:organization_schema_1.Organization.name,schema:organization_schema_1.OrganizationSchema}])],providers:[organization_service_1.OrganizationService],controllers:[organization_controller_1.OrganizationController],exports:[mongoose_1.MongooseModule,organization_service_1.OrganizationService]})],OrganizationModule),exports.OrganizationModule=OrganizationModule},8553:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.OrganizationSchema=exports.Organization=void 0;const tslib_1=__webpack_require__(752),mongoose_1=__webpack_require__(1794),class_validator_1=__webpack_require__(5849),mongoose_2=__webpack_require__(1185);let Organization=class Organization{};tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Naam moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Naam is verplicht!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],Organization.prototype,"name",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Email domein moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Email domein is verplicht!"}),(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],Organization.prototype,"emailDomain",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[],type:[mongoose_2.Types.ObjectId]}),tslib_1.__metadata("design:type",Array)],Organization.prototype,"events",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({default:[],type:[mongoose_2.Types.ObjectId]}),tslib_1.__metadata("design:type",Array)],Organization.prototype,"tags",void 0),Organization=tslib_1.__decorate([(0,mongoose_1.Schema)()],Organization),exports.Organization=Organization,exports.OrganizationSchema=mongoose_1.SchemaFactory.createForClass(Organization)},7446:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.OrganizationService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185),organization_schema_1=__webpack_require__(8553);let OrganizationService=class OrganizationService{constructor(organizationModel){this.organizationModel=organizationModel}getByEmailDomain(emailDomain){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const organization=yield this.organizationModel.findOne({emailDomain});if(!organization)throw new common_1.HttpException("Er bestaat geen organisatie met het opgegeven email domein!",common_1.HttpStatus.NOT_FOUND);return organization}))}getById(_id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const organization=yield this.organizationModel.findOne({_id});if(!organization)throw new common_1.HttpException("Organisatie bestaat niet!",common_1.HttpStatus.NOT_FOUND);return organization}))}getAll(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.organizationModel.find()}))}create(createOrganizationDTO){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.validate(createOrganizationDTO);const newOrganization=new this.organizationModel(Object.assign({},createOrganizationDTO));return yield this.organizationModel.create(newOrganization)}))}validate(organization){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if((yield this.organizationModel.find({name:organization.name})).length>0)throw new common_1.HttpException("Er bestaat al een bedrijf met de opgegeven naam!",common_1.HttpStatus.BAD_REQUEST);if((yield this.organizationModel.find({emailDomain:organization.emailDomain})).length>0)throw new common_1.HttpException("Er bestaat al een bedrijf met het opgegeven email domein!",common_1.HttpStatus.BAD_REQUEST)}))}};OrganizationService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,mongoose_1.InjectModel)(organization_schema_1.Organization.name)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mongoose_2.Model&&mongoose_2.Model)?_a:Object])],OrganizationService),exports.OrganizationService=OrganizationService},3058:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.MailModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),email_service_1=__webpack_require__(9032);let MailModule=class MailModule{};MailModule=tslib_1.__decorate([(0,common_1.Module)({providers:[email_service_1.MailService],exports:[email_service_1.MailService]})],MailModule),exports.MailModule=MailModule},9032:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.MailService=void 0;const tslib_1=__webpack_require__(752),mailer_1=__webpack_require__(2138),common_1=__webpack_require__(6481),environment_1=__webpack_require__(7483),auth_module_1=__webpack_require__(4188);let MailService=class MailService{constructor(mailService){this.mailService=mailService}SendVerificationMail(email,receiverName,verificationCode){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.mailService.sendMail({to:email,from:environment_1.environment.EMAIL_SENDINGEMAIL,subject:"Roots | E-mailverificatie",html:`<div style="font-family: Helvetica, sans-serif"> <h1 style="font-weight: bold">Welkom bij Roots, ${receiverName}!</h1> <p>Gebruik de onderstaande code om je account te verifiëren.</p> <p style="font-size:24px; color: #FBA92C; font-weight:900;">${verificationCode}</p> <p style="font-size: 11px; font-style: italic; margin-top: 15px">De code is voor de volgende 24 uur geldig.</p> <p style="font-size: 14px; margin-top: 25px">Groetjes het Roots-team</p> </div>`})}))}SendPasswordResetMail(email,receiverName,tokenId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const link=environment_1.environment.APPLICATION_URL+"/password_reset/"+tokenId;yield this.mailService.sendMail({to:email,from:environment_1.environment.EMAIL_SENDINGEMAIL,subject:"Roots | Wachtwoord resetten",html:`<div style="font-family: Helvetica, sans-serif"> <h1 style="font-weight: bold">Welkom bij Roots, ${receiverName}!</h1> <p style="padding-bottom:15px;">Druk op de onderstaande knop om je wachtwoord opnieuw in te stellen.</p> <a href="${link}" style="color: white; background: #fba92c; text-decoration: none; padding: 10px 28px;"> Wachtwoord instellen </a> <p style="font-size: 11px; font-style: italic; margin-top: 30px">De code is voor de volgende 24 uur geldig.</p> <p style="font-size: 14px; margin-top: 25px">Groetjes het Roots-team</p></div>`})}))}};tslib_1.__decorate([(0,auth_module_1.Public)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,String]),tslib_1.__metadata("design:returntype",Promise)],MailService.prototype,"SendVerificationMail",null),tslib_1.__decorate([(0,auth_module_1.Public)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,String]),tslib_1.__metadata("design:returntype",Promise)],MailService.prototype,"SendPasswordResetMail",null),MailService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mailer_1.MailerService&&mailer_1.MailerService)?_a:Object])],MailService),exports.MailService=MailService},8526:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.ValidationException=void 0;const common_1=__webpack_require__(6481);class ValidationException extends common_1.BadRequestException{constructor(validationErrors){super(),this.validationErrors=validationErrors}}exports.ValidationException=ValidationException},4590:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.ValidationFilter=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),validation_exception_1=__webpack_require__(8526);let ValidationFilter=class ValidationFilter{catch(exception,host){return host.switchToHttp().getResponse().status(400).json({statusCode:400,timestamp:(new Date).toISOString(),errors:exception.validationErrors})}};ValidationFilter=tslib_1.__decorate([(0,common_1.Catch)(validation_exception_1.ValidationException)],ValidationFilter),exports.ValidationFilter=ValidationFilter},8725:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.ParseObjectIdPipe=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongodb_1=__webpack_require__(8013),validation_exception_1=__webpack_require__(8526);let ParseObjectIdPipe=class ParseObjectIdPipe{transform(value){try{return mongodb_1.ObjectId.createFromHexString(value)}catch(error){throw new validation_exception_1.ValidationException([`ObjectId has wrong value: ${value}, ObjectId is not valid!`])}}static isValidObjectId(value){try{return mongodb_1.ObjectId.createFromHexString(value),!0}catch(error){return!1}}};ParseObjectIdPipe=tslib_1.__decorate([(0,common_1.Injectable)()],ParseObjectIdPipe),exports.ParseObjectIdPipe=ParseObjectIdPipe},5596:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j;Object.defineProperty(exports,"__esModule",{value:!0}),exports.TagController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_module_1=__webpack_require__(4188),ParseObjectIdPipe_1=__webpack_require__(8725),tag_dto_1=__webpack_require__(1739),tag_service_1=__webpack_require__(8959);let TagController=class TagController{constructor(tagService){this.tagService=tagService}getAllTagsByOrganization(organizationId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Retrieving all tags by organization (READ)"),yield this.tagService.getAllByOrganization(organizationId)}))}getTagById(tagId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){try{return common_1.Logger.log(`Retrieve tag with id: ${tagId} (READ)`),yield this.tagService.getById(tagId)}catch(error){throw new common_1.HttpException(error.message,common_1.HttpStatus.NOT_FOUND)}}))}createTagInEvent(organizationId,eventId,tagDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){try{return common_1.Logger.log("Create tag (POST)"),yield this.tagService.createInEvent(organizationId,eventId,tagDto),{status:201,message:"De tag is succesvol aangemaakt!"}}catch(error){throw new common_1.HttpException(error.message,common_1.HttpStatus.NOT_FOUND)}}))}createTagInOrganization(organizationId,tagDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){try{common_1.Logger.log("Create tag (POST)");yield this.tagService.createInOrganization(organizationId,tagDto);return{status:201,message:"De tag is succesvol aangemaakt!"}}catch(error){throw new common_1.HttpException(error.message,common_1.HttpStatus.NOT_FOUND)}}))}updateTag(tagId,tagDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){try{common_1.Logger.log(`Update tag ${tagId} (PUT)`);yield this.tagService.update(tagId,tagDto);return{status:200,message:"De tag is succesvol aangepast!"}}catch(error){throw new common_1.HttpException(error.message,common_1.HttpStatus.NOT_MODIFIED)}}))}};tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)("organizations/:organizationId"),tslib_1.__param(0,(0,common_1.Param)("organizationId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_b="undefined"!=typeof Promise&&Promise)?_b:Object)],TagController.prototype,"getAllTagsByOrganization",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)(":tagId"),tslib_1.__param(0,(0,common_1.Param)("tagId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_c="undefined"!=typeof Promise&&Promise)?_c:Object)],TagController.prototype,"getTagById",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Post)("new/organizations/:organizationId/events/:eventId"),tslib_1.__param(0,(0,common_1.Param)("organizationId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Param)("eventId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(2,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,String,"function"==typeof(_d=void 0!==tag_dto_1.TagDto&&tag_dto_1.TagDto)?_d:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_e="undefined"!=typeof Promise&&Promise)?_e:Object)],TagController.prototype,"createTagInEvent",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Post)("new/organizations/:organizationId"),tslib_1.__param(0,(0,common_1.Param)("organizationId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_f=void 0!==tag_dto_1.TagDto&&tag_dto_1.TagDto)?_f:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_g="undefined"!=typeof Promise&&Promise)?_g:Object)],TagController.prototype,"createTagInOrganization",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Put)(":tagId"),tslib_1.__param(0,(0,common_1.Param)("tagId",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,"function"==typeof(_h=void 0!==tag_dto_1.TagDto&&tag_dto_1.TagDto)?_h:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_j="undefined"!=typeof Promise&&Promise)?_j:Object)],TagController.prototype,"updateTag",null),TagController=tslib_1.__decorate([(0,common_1.Controller)("tags"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==tag_service_1.TagService&&tag_service_1.TagService)?_a:Object])],TagController),exports.TagController=TagController},1739:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.TagDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(5849);class TagDto{}tslib_1.__decorate([(0,class_validator_1.IsNotEmpty)({message:"Naam is verplicht!"}),(0,class_validator_1.IsDefined)({message:"Naam is verplicht!"}),(0,class_validator_1.MaxLength)(15,{message:"Naam is te lang!"}),(0,class_validator_1.IsString)({message:"Name moet van het type string zijn!"}),tslib_1.__metadata("design:type",String)],TagDto.prototype,"name",void 0),exports.TagDto=TagDto},1055:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.TagModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),event_schema_1=__webpack_require__(2480),organization_schema_1=__webpack_require__(8553),tag_controller_1=__webpack_require__(5596),tag_schema_1=__webpack_require__(9365),tag_service_1=__webpack_require__(8959);let TagModule=class TagModule{};TagModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forFeature([{name:tag_schema_1.Tag.name,schema:tag_schema_1.TagSchema}]),mongoose_1.MongooseModule.forFeature([{name:organization_schema_1.Organization.name,schema:organization_schema_1.OrganizationSchema}]),mongoose_1.MongooseModule.forFeature([{name:Event.name,schema:event_schema_1.EventSchema}])],providers:[tag_service_1.TagService],controllers:[tag_controller_1.TagController],exports:[mongoose_1.MongooseModule,tag_service_1.TagService]})],TagModule),exports.TagModule=TagModule},9365:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.TagSchema=exports.Tag=void 0;const tslib_1=__webpack_require__(752),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185);let Tag=class Tag{};tslib_1.__decorate([(0,mongoose_1.Prop)({unique:!0,required:!0}),tslib_1.__metadata("design:type",String)],Tag.prototype,"name",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({type:mongoose_2.Types.ObjectId,required:!0}),tslib_1.__metadata("design:type","function"==typeof(_a=void 0!==mongoose_2.Types&&mongoose_2.Types.ObjectId)?_a:Object)],Tag.prototype,"organization",void 0),Tag=tslib_1.__decorate([(0,mongoose_1.Schema)()],Tag),exports.Tag=Tag,exports.TagSchema=mongoose_1.SchemaFactory.createForClass(Tag)},8959:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.TagService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185),organization_schema_1=__webpack_require__(8553),tag_schema_1=__webpack_require__(9365),event_schema_1=__webpack_require__(2480);let TagService=class TagService{constructor(tagModel,organizationModel,eventModel){this.tagModel=tagModel,this.organizationModel=organizationModel,this.eventModel=eventModel}getAllByOrganization(organizationId){var e_1,_a;return tslib_1.__awaiter(this,void 0,void 0,(function*(){const organizationTagIds=yield this.organizationModel.findOne({_id:new mongoose_2.Types.ObjectId(organizationId)},{tags:1});if(!organizationTagIds)throw new common_1.HttpException("Organisatie niet gevonden",common_1.HttpStatus.NOT_FOUND);let tags=[];try{for(var _c,_b=tslib_1.__asyncValues(organizationTagIds.tags);!(_c=yield _b.next()).done;){const tagId=_c.value,tag=yield this.tagModel.findOne({_id:new mongoose_2.Types.ObjectId(tagId)});tags.push({_id:tag._id,name:tag.name,organisation:tag.organization})}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&(yield _a.call(_b))}finally{if(e_1)throw e_1.error}}return tags}))}getById(tagId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const tag=yield this.tagModel.findOne({_id:new mongoose_2.Types.ObjectId(tagId)});if(!tag)throw new common_1.HttpException("Tag niet gevonden",common_1.HttpStatus.NOT_FOUND);return tag}))}createInEvent(organizationId,eventId,tagDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const organization=yield this.organizationModel.findOne({_id:new mongoose_2.Types.ObjectId(organizationId)});if(!organization)throw new common_1.HttpException("Organisatie niet gevonden",common_1.HttpStatus.NOT_FOUND);if(!(yield organization).events.filter((p=>new mongoose_2.Types.ObjectId(p._id).equals(new mongoose_2.Types.ObjectId(eventId)))).at(0))throw new common_1.HttpException(`Event niet gevonden van organisatie met id: ${organizationId}`,common_1.HttpStatus.NOT_FOUND);const newTag=new this.tagModel(Object.assign(Object.assign({},tagDto),{organization:new mongoose_2.Types.ObjectId(organizationId)})),tag=yield this.tagModel.create(newTag);if(!tag)throw new common_1.HttpException("Kan geen nieuwe tag aanmaken",common_1.HttpStatus.BAD_REQUEST);return yield this.organizationModel.updateOne({_id:new mongoose_2.Types.ObjectId(organizationId)},{$push:{tags:new mongoose_2.Types.ObjectId(tag._id)}},{new:!0}),yield this.eventModel.updateOne({_id:new mongoose_2.Types.ObjectId(eventId)},{$push:{tags:new mongoose_2.Types.ObjectId(tag._id)}},{new:!0}),tag}))}createInOrganization(organizationId,tagDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(!this.organizationModel.findOne({_id:new mongoose_2.Types.ObjectId(organizationId)}))throw new common_1.HttpException("Organisatie niet gevonden",common_1.HttpStatus.NOT_FOUND);const newTag=new this.tagModel(Object.assign(Object.assign({},tagDto),{organization:new mongoose_2.Types.ObjectId(organizationId)})),tag=yield this.tagModel.create(newTag);if(!tag)throw new common_1.HttpException("Kan geen nieuwe tag aanmaken",common_1.HttpStatus.BAD_REQUEST);return yield this.organizationModel.updateOne({_id:new mongoose_2.Types.ObjectId(organizationId)},{$push:{tags:new mongoose_2.Types.ObjectId(tag._id)}},{new:!0}),tag}))}update(tagId,tagDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const updatedTag=yield this.tagModel.findOneAndUpdate({_id:new mongoose_2.Types.ObjectId(tagId)},{$set:{name:null==tagDto?void 0:tagDto.name}},{new:!0,runValidators:!0});if(!updatedTag)throw new common_1.HttpException("Deze tag bestaat niet",common_1.HttpStatus.NOT_FOUND);return updatedTag}))}};TagService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,mongoose_1.InjectModel)(tag_schema_1.Tag.name)),tslib_1.__param(1,(0,mongoose_1.InjectModel)(organization_schema_1.Organization.name)),tslib_1.__param(2,(0,mongoose_1.InjectModel)(event_schema_1.Event.name)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mongoose_2.Model&&mongoose_2.Model)?_a:Object,"function"==typeof(_b=void 0!==mongoose_2.Model&&mongoose_2.Model)?_b:Object,"function"==typeof(_c=void 0!==mongoose_2.Model&&mongoose_2.Model)?_c:Object])],TagService),exports.TagService=TagService},4247:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.TokenModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),token_schema_1=__webpack_require__(3119),token_service_1=__webpack_require__(2469);let TokenModule=class TokenModule{};TokenModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forFeature([{name:token_schema_1.Token.name,schema:token_schema_1.TokenSchema}])],providers:[token_service_1.TokenService],exports:[mongoose_1.MongooseModule,token_service_1.TokenService]})],TokenModule),exports.TokenModule=TokenModule},3119:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.TokenSchema=exports.Token=void 0;const tslib_1=__webpack_require__(752),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185);let Token=class Token{};tslib_1.__decorate([(0,mongoose_1.Prop)({required:!0}),tslib_1.__metadata("design:type",String)],Token.prototype,"type",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",String)],Token.prototype,"verificationCode",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({required:!0}),tslib_1.__metadata("design:type","function"==typeof(_a="undefined"!=typeof Date&&Date)?_a:Object)],Token.prototype,"expirationDate",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({ref:"User",type:mongoose_2.Types.ObjectId}),tslib_1.__metadata("design:type","function"==typeof(_b=void 0!==mongoose_2.Types&&mongoose_2.Types.ObjectId)?_b:Object)],Token.prototype,"userId",void 0),Token=tslib_1.__decorate([(0,mongoose_1.Schema)()],Token),exports.Token=Token,exports.TokenSchema=mongoose_1.SchemaFactory.createForClass(Token)},2469:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.TokenService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),mongoose_2=__webpack_require__(1185),token_schema_1=__webpack_require__(3119);let TokenService=class TokenService{constructor(tokenModel){this.tokenModel=tokenModel}getById(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const token=yield this.tokenModel.findOne({_id:id});if(!token)throw new common_1.HttpException("Token bestaat niet!",common_1.HttpStatus.NOT_FOUND);return token}))}getByUserId(userId,type){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const token=yield this.tokenModel.findOne({userId,type});if(!token)throw new common_1.HttpException("Token bestaat niet!",common_1.HttpStatus.NOT_FOUND);return token}))}create(type,userId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const newToken={type,expirationDate:new Date(Date.now()+864e5),userId};return newToken.verificationCode="verification"===type?Math.floor(1e5+9e5*Math.random()):"",yield this.tokenModel.create(newToken)}))}delete(userId,type){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.tokenModel.deleteMany({userId,type})}))}};TokenService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,mongoose_1.InjectModel)(token_schema_1.Token.name)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mongoose_2.Model&&mongoose_2.Model)?_a:Object])],TokenService),exports.TokenService=TokenService},625:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c,_d,_e,_f;Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),auth_module_1=__webpack_require__(4188),ParseObjectIdPipe_1=__webpack_require__(8725),user_dto_1=__webpack_require__(565),user_service_1=__webpack_require__(6389);let UserController=class UserController{constructor(userService){this.userService=userService}getParticipants(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Retrieve participants (READ)"),yield this.userService.getAllParticipants(id)}))}getById(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Retrieve user with id: ${id} (READ)`),yield this.userService.getById(id)}))}create(UserDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log("Creating user (CREATE)"),yield this.userService.create(UserDto)}))}status(id,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return common_1.Logger.log(`Changing isActive status of user with an id of ${id} (POST)`),yield this.userService.status(id,req)}))}};tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)("organizations/:id/participants"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_b="undefined"!=typeof Promise&&Promise)?_b:Object)],UserController.prototype,"getParticipants",null),tslib_1.__decorate([(0,auth_module_1.Public)(),(0,common_1.Get)("users/:id"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype","function"==typeof(_c="undefined"!=typeof Promise&&Promise)?_c:Object)],UserController.prototype,"getById",null),tslib_1.__decorate([(0,common_1.Post)("users/new"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",["function"==typeof(_d=void 0!==user_dto_1.UserDto&&user_dto_1.UserDto)?_d:Object]),tslib_1.__metadata("design:returntype","function"==typeof(_e="undefined"!=typeof Promise&&Promise)?_e:Object)],UserController.prototype,"create",null),tslib_1.__decorate([(0,common_1.Post)("users/:id/status"),tslib_1.__param(0,(0,common_1.Param)("id",ParseObjectIdPipe_1.ParseObjectIdPipe)),tslib_1.__param(1,(0,common_1.Req)()),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String,Object]),tslib_1.__metadata("design:returntype","function"==typeof(_f="undefined"!=typeof Promise&&Promise)?_f:Object)],UserController.prototype,"status",null),UserController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==user_service_1.UserService&&user_service_1.UserService)?_a:Object])],UserController),exports.UserController=UserController},565:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserDto=void 0;const tslib_1=__webpack_require__(752),class_validator_1=__webpack_require__(5849);class UserDto{}tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Voornaam moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Voornaam is verplicht!"}),tslib_1.__metadata("design:type",String)],UserDto.prototype,"firstname",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Achternaam moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Achternaam is verplicht!"}),tslib_1.__metadata("design:type",String)],UserDto.prototype,"lastname",void 0),tslib_1.__decorate([(0,class_validator_1.IsEmail)(),(0,class_validator_1.IsString)({message:"E-mailadres moet van het type string zijn!!"}),(0,class_validator_1.IsDefined)({message:"E-mailadres is verplicht!"}),tslib_1.__metadata("design:type",String)],UserDto.prototype,"emailAddress",void 0),tslib_1.__decorate([(0,class_validator_1.IsString)({message:"Wachtwoord moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Wachtwoord is verplicht!"}),(0,class_validator_1.Matches)(new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)[a-zA-Z\\d]{8,}$"),{message:"Het wachtwoord is niet sterk genoeg! Het moet op zijn minst bestaan uit: 8 karakters, 1 hoofdletter, 1 kleine letter and 1 getal!"}),tslib_1.__metadata("design:type",String)],UserDto.prototype,"password",void 0),exports.UserDto=UserDto},8388:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),organization_module_1=__webpack_require__(2730),user_controller_1=__webpack_require__(625),user_schema_1=__webpack_require__(2621),user_service_1=__webpack_require__(6389);let UserModule=class UserModule{};UserModule=tslib_1.__decorate([(0,common_1.Module)({imports:[mongoose_1.MongooseModule.forFeature([{name:user_schema_1.User.name,schema:user_schema_1.UserSchema}]),organization_module_1.OrganizationModule],controllers:[user_controller_1.UserController],providers:[user_service_1.UserService],exports:[user_service_1.UserService]})],UserModule),exports.UserModule=UserModule},2621:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b,_c;Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserSchema=exports.User=void 0;const tslib_1=__webpack_require__(752),mongoose_1=__webpack_require__(1794),class_validator_1=__webpack_require__(5849),mongoose_2=__webpack_require__(1185);let User=class User{};tslib_1.__decorate([(0,mongoose_1.Prop)({required:!0}),(0,class_validator_1.IsString)({message:"Voornaam moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Voornaam is verplicht!"}),tslib_1.__metadata("design:type",String)],User.prototype,"firstname",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({required:!0}),(0,class_validator_1.IsString)({message:"Achternaam moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Achternaam is verplicht!"}),tslib_1.__metadata("design:type",String)],User.prototype,"lastname",void 0),tslib_1.__decorate([(0,class_validator_1.IsEmail)(),(0,class_validator_1.IsString)({message:"E-mailadres moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"E-mailadres is verplicht!"}),(0,mongoose_1.Prop)({required:!0,unique:!0,validate:class_validator_1.isEmail}),tslib_1.__metadata("design:type",String)],User.prototype,"emailAddress",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({required:!0}),(0,class_validator_1.IsString)({message:"Wachtwoord moet van het type string zijn!"}),(0,class_validator_1.IsDefined)({message:"Wachtwoord is verplicht!"}),(0,class_validator_1.Matches)(new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)[a-zA-Z\\d]{8,}$"),{message:"Het wachtwoord is niet sterk genoeg! Het moet op zijn minst bestaan uit: 8 karakters, 1 hoofdletter, 1 kleine letter and 1 getal!"}),tslib_1.__metadata("design:type",String)],User.prototype,"password",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",Boolean)],User.prototype,"isActive",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type",Boolean)],User.prototype,"isVerified",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type","function"==typeof(_a="undefined"!=typeof Date&&Date)?_a:Object)],User.prototype,"createdAt",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)(),tslib_1.__metadata("design:type","function"==typeof(_b="undefined"!=typeof Date&&Date)?_b:Object)],User.prototype,"lastLoginTimestamp",void 0),tslib_1.__decorate([(0,mongoose_1.Prop)({ref:"Organization",type:mongoose_2.Types.ObjectId}),tslib_1.__metadata("design:type","function"==typeof(_c=void 0!==mongoose_2.Types&&mongoose_2.Types.ObjectId)?_c:Object)],User.prototype,"organization",void 0),User=tslib_1.__decorate([(0,mongoose_1.Schema)()],User),exports.User=User,exports.UserSchema=mongoose_1.SchemaFactory.createForClass(User)},6389:(__unused_webpack_module,exports,__webpack_require__)=>{var _a,_b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),mongoose_1=__webpack_require__(1794),bcrypt=__webpack_require__(8432),mongoose_2=__webpack_require__(1185),organization_service_1=__webpack_require__(7446),user_schema_1=__webpack_require__(2621);let UserService=class UserService{constructor(userModel,organizationService){this.userModel=userModel,this.organizationService=organizationService}findByEmailAddress(emailAddress){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userModel.findOne({emailAddress});if(!user)throw new common_1.HttpException("Gebruiker bestaat niet!",common_1.HttpStatus.NOT_FOUND);return user}))}getById(_id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userModel.findOne({_id});if(!user)throw new common_1.HttpException("Gebruiker bestaat niet!",common_1.HttpStatus.NOT_FOUND);return user}))}getAllParticipants(organizationId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield this.userModel.find({organization:organizationId})}))}create(UserDto){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.validate(UserDto);const newUser=new this.userModel(Object.assign(Object.assign({},UserDto),{password:yield bcrypt.hashSync(UserDto.password,10),isActive:!0,isVerified:!1,createdAt:new Date,organization:yield this.organizationService.getByEmailDomain(UserDto.emailAddress.split("@").at(1))}));return yield this.userModel.create(newUser)}))}setLastLoginTimeStamp(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userModel.findOneAndUpdate({_id:id},[{$set:{lastLoginTimestamp:new Date}}]);if(!user)throw new common_1.HttpException("Gebruiker bestaat niet!",common_1.HttpStatus.NOT_FOUND);return user}))}setPassword(userId,password){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const encryptedPassword=yield bcrypt.hashSync(password,10),user=yield this.userModel.findOneAndUpdate({_id:userId},{password:encryptedPassword});if(!user)throw new common_1.HttpException("Gebruiker bestaat niet!",common_1.HttpStatus.NOT_FOUND);return user}))}verifyAccount(userId){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const user=yield this.userModel.findOneAndUpdate({_id:userId},[{$set:{isVerified:!0}}]);if(!user)throw new common_1.HttpException("Gebruiker bestaat niet!",common_1.HttpStatus.NOT_FOUND);return user}))}status(id,req){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if((yield this.getById(id)).organization.toString()!==req.user.organization.toString())throw new common_1.HttpException("Je mag alleen gebruikers van activeren/deactiveren van het bedrijf waar je werkt!",common_1.HttpStatus.BAD_REQUEST);if(id.toString()===req.user._id.toString())throw new common_1.HttpException("Je mag jouw eigen account niet activeren/deactiveren!",common_1.HttpStatus.BAD_REQUEST);return yield this.userModel.findOneAndUpdate({_id:id},[{$set:{isActive:{$not:"$isActive"}}}],{new:!0})}))}validate(user){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if((yield this.userModel.find({emailAddress:user.emailAddress})).length>0)throw new common_1.HttpException("Het e-mailadres is al in gebruik!",common_1.HttpStatus.BAD_REQUEST)}))}};UserService=tslib_1.__decorate([(0,common_1.Injectable)(),tslib_1.__param(0,(0,mongoose_1.InjectModel)(user_schema_1.User.name)),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==mongoose_2.Model&&mongoose_2.Model)?_a:Object,"function"==typeof(_b=void 0!==organization_service_1.OrganizationService&&organization_service_1.OrganizationService)?_b:Object])],UserService),exports.UserService=UserService},7483:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.environment=void 0;const password=process.env.PASSWORD_MONGO_URL;exports.environment={production:!0,API_URL:`mongodb+srv://admin:${password}@cluster0.ygjk7ng.mongodb.net/?retryWrites=true&w=majority`,APPLICATION_URL:"https://ih-roots.netlify.app",EMAIL_HOST:"smtp.sendgrid.net",EMAIL_USERNAME:"apikey",EMAIL_API_KEY:"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",EMAIL_SENDINGEMAIL:"roots.team.noreply@gmail.com"}},2138:module=>{module.exports=require("@nestjs-modules/mailer")},6481:module=>{module.exports=require("@nestjs/common")},143:module=>{module.exports=require("@nestjs/core")},2064:module=>{module.exports=require("@nestjs/jwt")},1794:module=>{module.exports=require("@nestjs/mongoose")},4340:module=>{module.exports=require("@nestjs/passport")},8432:module=>{module.exports=require("bcryptjs")},5849:module=>{module.exports=require("class-validator")},6860:module=>{module.exports=require("express")},8013:module=>{module.exports=require("mongodb")},1185:module=>{module.exports=require("mongoose")},136:module=>{module.exports=require("passport-jwt")},7055:module=>{module.exports=require("passport-local")},752:module=>{module.exports=require("tslib")}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}var __webpack_exports__={};(()=>{var exports=__webpack_exports__;Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__(752),common_1=__webpack_require__(6481),core_1=__webpack_require__(143),express_1=__webpack_require__(6860),app_module_1=__webpack_require__(3713),validation_exception_1=__webpack_require__(8526),validation_filter_1=__webpack_require__(4590);!function(){tslib_1.__awaiter(this,void 0,void 0,(function*(){const app=yield core_1.NestFactory.create(app_module_1.AppModule);app.setGlobalPrefix("api"),app.use((0,express_1.json)({limit:"50mb"})),app.use((0,express_1.urlencoded)({extended:!0,limit:"50mb"})),app.enableCors();const port=process.env.PORT||9e3;app.useGlobalFilters(new validation_filter_1.ValidationFilter),app.useGlobalPipes(new common_1.ValidationPipe({skipMissingProperties:!0,exceptionFactory:errors=>{const messages=errors.map((error=>`${error.property} has wrong value: ${error.value}, ${Object.values(error.constraints).join(", ")}`));return new validation_exception_1.ValidationException(messages)}})),yield app.listen(port),common_1.Logger.log(`🚀 Application is running on: http://localhost:${port}/api`)}))}()})();var __webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();
//# sourceMappingURL=main.js.map